const APP_CACHE="app-shell-v1.1",DATA_CACHE="data-cache-v1",APP_SHELL=["index.html"];self.addEventListener("install",(t=>{t.waitUntil(caches.open(APP_CACHE).then((t=>t.addAll(APP_SHELL)))),self.skipWaiting()})),self.addEventListener("activate",(t=>{t.waitUntil(caches.keys().then((t=>Promise.all(t.map((t=>{if(![APP_CACHE,DATA_CACHE].includes(t))return caches.delete(t)})))))),self.clients.claim()})),self.addEventListener("fetch",(t=>{const{request:e}=t,n=new URL(e.url);"https://story-api.dicoding.dev"===n.origin&&n.pathname.startsWith("/v1")?t.respondWith(caches.open(DATA_CACHE).then((async t=>{const n=await t.match(e),i=fetch(e).then((n=>(t.put(e,n.clone()),n))).catch((()=>n));return n||i}))):t.respondWith(fetch(e).catch((()=>caches.match(e))))})),self.addEventListener("push",(t=>{let e={};try{e=t.data?t.data.json():{}}catch(t){e={}}const n=e.title||"Story berhasil dibuat",i=e.options?.body||"Anda telah membuat story baru.",a=e.icon||"/public/images/logo.png",s=e.storyId?`/#/detail/${e.storyId}`:null,c={body:i,icon:a,badge:a,data:{url:e.url||s||"/#/",storyId:e.storyId},actions:[{action:"open",title:"Buka"}]};t.waitUntil(self.registration.showNotification(n,c))})),self.addEventListener("notificationclick",(t=>{t.notification.close();const e=t.notification.data?.url||"/#/";t.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((t=>{for(const n of t)if("focus"in n)return n.navigate(e),n.focus();if(clients.openWindow)return clients.openWindow(e)})))}));